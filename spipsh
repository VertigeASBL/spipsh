#!/bin/bash
#
# Description : Contrôle SPIP à la ligne de commande. Doit être exécuté depuis
# la racine d'un site spip.
#
# Usage : spipsh [COMMAND]
#
# Options :
#
# % dry-run
# desc="Ne pas exécuter les commandes, seulement les afficher."
# short="d" type="flag" variable="dry_run" value=1 default=0
#
# % connect
# desc="Permet de choisir un fichier connect.php alternatif."
# short="c" type="option" variable="connect" default="connect"
#
set -euo pipefail

# shellcheck source=vendor/bash-args/init_script.sh
. "$(dirname "$(readlink -f "$0")")"/vendor/bash-args/init_script.sh

# shellcheck source=lib/spip.sh
. "${SCRIPT_DIR}"/lib/spip.sh


# shellcheck disable=2154
if [[ ! -f "config/$connect.php" ]]; then
    out_usage_error "config/$connect.php n'est pas un fichier."
fi


if [[ -f "${SCRIPT_DIR}/${CMDS_DIR}/${CMD-}.sh" ]] && [[ $( _meta_get "env" "$CMD") == 'spip' ]]; then
    _spip_get_env;
fi;


cmds_do_subcommand
